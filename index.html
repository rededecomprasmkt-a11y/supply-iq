<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rede de Compras Â· Supply IQ</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{background:#080d14;color:#e8f0fe;font-family:'DM Sans',sans-serif;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.card{width:100%;max-width:400px;background:#0f1520;border:1px solid rgba(0,229,160,0.15);border-radius:20px;padding:40px 36px;box-shadow:0 24px 80px rgba(0,0,0,0.6)}
.logo{display:flex;align-items:center;gap:12px;margin-bottom:32px}
.logo-icon{width:44px;height:44px;border-radius:11px;background:linear-gradient(135deg,#00e5a0,#4f8cff);display:flex;align-items:center;justify-content:center;font-size:20px}
.logo-name{font-size:17px;font-weight:700}
.logo-sub{font-size:10px;color:#4f6a90;font-family:'JetBrains Mono',monospace;letter-spacing:1px;text-transform:uppercase}
.tabs{display:flex;gap:0;margin-bottom:24px;background:rgba(255,255,255,0.04);border-radius:10px;padding:3px}
.tab{flex:1;padding:9px;border:none;border-radius:8px;background:none;color:#6b82a6;font-family:'DM Sans',sans-serif;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.tab.active{background:rgba(0,229,160,0.12);color:#00e5a0;border:1px solid rgba(0,229,160,0.2)}
label{display:block;font-size:11px;font-weight:600;color:#4f6a90;font-family:'JetBrains Mono',monospace;letter-spacing:1px;text-transform:uppercase;margin-bottom:5px}
input{width:100%;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:10px;color:#e8f0fe;font-family:'DM Sans',sans-serif;font-size:14px;padding:12px 14px;outline:none;transition:border-color .2s;margin-bottom:14px}
input:focus{border-color:rgba(0,229,160,0.5)}
input::placeholder{color:#2a3a52}
.btn{width:100%;border:none;border-radius:11px;font-family:'DM Sans',sans-serif;font-size:14px;font-weight:700;padding:13px;cursor:pointer;transition:all .2s}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important}
.btn-green{background:linear-gradient(135deg,#00e5a0,#4f8cff);color:#000}
.btn-blue{background:linear-gradient(135deg,#4f8cff,#7c5cbf);color:#fff}
.btn-green:not(:disabled):hover,.btn-blue:not(:disabled):hover{opacity:.9;transform:translateY(-1px)}
.error{display:none;margin-top:12px;padding:10px 14px;background:rgba(255,59,92,.1);border:1px solid rgba(255,59,92,.2);border-radius:8px;font-size:12px;color:#ff3b5c;font-family:'JetBrains Mono',monospace}
.sep{margin-top:22px;padding-top:18px;border-top:1px solid rgba(255,255,255,0.06)}
.url-status{font-size:11px;margin-top:-8px;margin-bottom:14px;font-family:'JetBrains Mono',monospace;color:#4f6a90;min-height:16px}
.spinner{display:none;flex-direction:column;align-items:center;gap:14px;padding:24px 0}
.spin{width:32px;height:32px;border:3px solid rgba(0,229,160,.2);border-top-color:#00e5a0;border-radius:50%;animation:s .8s linear infinite}
@keyframes s{to{transform:rotate(360deg)}}
.spin-text{font-size:13px;color:#6b82a6;font-family:'JetBrains Mono',monospace}
</style>
</head>
<body>
<div class="card">
  <div class="logo">
    <div class="logo-icon">ğŸ”—</div>
    <div>
      <div class="logo-name">Rede de Compras</div>
      <div class="logo-sub">Supply_IQ Â· v7</div>
    </div>
  </div>

  <div class="tabs">
    <button class="tab active" id="tab-user"  onclick="showTab('user')">ğŸ”‘ UsuÃ¡rio</button>
    <button class="tab"        id="tab-admin" onclick="showTab('admin')">âš™ï¸ Admin</button>
  </div>

  <div id="main">
    <!-- USUÃRIO -->
    <div id="panel-user">
      <label>Email</label>
      <input type="email" id="u-email" placeholder="seu@email.com" autocomplete="email">
      <label>Senha</label>
      <input type="password" id="u-senha" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
        onkeydown="if(event.key==='Enter')loginUsuario()">
      <button class="btn btn-green" id="btn-user" onclick="loginUsuario()">Entrar</button>
    </div>

    <!-- ADMIN -->
    <div id="panel-admin" style="display:none">
      <label>Senha do Admin</label>
      <input type="password" id="a-senha" placeholder="admin123"
        onkeydown="if(event.key==='Enter')loginAdmin()">
      <button class="btn btn-blue" id="btn-admin" onclick="loginAdmin()">Entrar como Admin</button>

      <div class="sep">
        <label>URL do Apps Script</label>
        <input type="url" id="a-url"
          placeholder="https://script.google.com/macros/s/â€¦/exec"
          style="font-size:11px;font-family:'JetBrains Mono',monospace"
          onblur="salvarUrl(this.value)">
        <div class="url-status" id="url-status"></div>
      </div>
    </div>

    <div class="error" id="err"></div>
  </div>

  <div class="spinner" id="spin">
    <div class="spin"></div>
    <div class="spin-text" id="spin-msg">Verificandoâ€¦</div>
  </div>
</div>

<script>
const API_KEY    = 'supplyiq2026';
const ADMIN_HASH = '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9'; // admin123

async function sha256(s){
  const b = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(s));
  return Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join('');
}

function showTab(t){
  document.getElementById('tab-user').className  = 'tab'+(t==='user' ?' active':'');
  document.getElementById('tab-admin').className = 'tab'+(t==='admin'?' active':'');
  document.getElementById('panel-user').style.display  = t==='user' ?'':'none';
  document.getElementById('panel-admin').style.display = t==='admin'?'':'none';
  document.getElementById('err').style.display='none';
}
function err(msg){ const e=document.getElementById('err'); e.textContent=msg; e.style.display=''; }
function loading(on,msg){
  document.getElementById('main').style.display = on?'none':'';
  document.getElementById('spin').style.display = on?'flex':'none';
  if(msg) document.getElementById('spin-msg').textContent=msg;
}
function go(role,nome,email){
  sessionStorage.setItem('siq_token','ok');
  sessionStorage.setItem('siq_user', JSON.stringify({role,nome,email}));
  window.location.href='app.html';
}

// â”€â”€ Admin â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loginAdmin(){
  const senha = document.getElementById('a-senha').value;
  if(!senha){ err('Digite a senha.'); return; }
  const btn = document.getElementById('btn-admin');
  btn.disabled=true; btn.textContent='â³ Verificandoâ€¦';
  document.getElementById('err').style.display='none';
  try{
    const h = await sha256(senha);
    const valid = localStorage.getItem('siq_admin_hash') || ADMIN_HASH;
    if(h!==valid){ err('Senha incorreta. PadrÃ£o: admin123'); return; }
    go('admin','Admin','admin');
  }catch(e){ err('Erro: '+e.message); }
  finally{ btn.disabled=false; btn.textContent='Entrar como Admin'; }
}

// â”€â”€ UsuÃ¡rio â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loginUsuario(){
  const email = document.getElementById('u-email').value.trim().toLowerCase();
  const senha = document.getElementById('u-senha').value;
  if(!email||!senha){ err('Preencha email e senha.'); return; }

  const apiUrl = localStorage.getItem('siq_api_url');
  if(!apiUrl){ err('Sistema nÃ£o configurado. Fale com o admin.'); return; }

  const btn = document.getElementById('btn-user');
  btn.disabled=true; btn.textContent='â³ Verificandoâ€¦';
  document.getElementById('err').style.display='none';
  loading(true,'Verificando credenciaisâ€¦');

  try{
    const senhaHash = await sha256(senha);
    const r = await fetch(apiUrl,{
      method:'POST',
      headers:{'Content-Type':'text/plain'},
      body: JSON.stringify({action:'login',key:API_KEY,email,senhaHash})
    });
    if(!r.ok) throw new Error('HTTP '+r.status);
    const d = await r.json();
    if(!d.ok){ loading(false); err(d.error||'Email ou senha incorretos.'); return; }
    go(d.user.role||'user', d.user.nome||email, d.user.email);
  }catch(e){
    loading(false);
    // Fallback: cache local
    try{
      const cache = localStorage.getItem('siq_usuarios_cache');
      if(cache){
        const lista = JSON.parse(cache);
        const h = await sha256(senha);
        const u = lista.find(x=>x.email===email&&x.senha===h&&x.ativo!==false);
        if(u){ go(u.role||'user',u.nome||email,u.email); return; }
      }
    }catch(e2){}
    err('NÃ£o foi possÃ­vel conectar. Verifique a URL do Apps Script na aba Admin.');
  }finally{
    btn.disabled=false; btn.textContent='Entrar';
  }
}

// â”€â”€ URL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function salvarUrl(url){
  url=url.trim();
  const st=document.getElementById('url-status');
  if(!url){ localStorage.removeItem('siq_api_url'); st.textContent=''; return; }
  localStorage.setItem('siq_api_url',url);
  st.style.color='#00e5a0'; st.textContent='âœ… URL salva!';
}

// â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.onload=function(){
  if(sessionStorage.getItem('siq_token')){ window.location.href='app.html'; return; }
  const url=localStorage.getItem('siq_api_url');
  if(url){
    document.getElementById('a-url').value=url;
    document.getElementById('url-status').textContent='âœ… URL configurada';
    document.getElementById('url-status').style.color='#00e5a0';
  }
};
</script>
</body>
</html>
